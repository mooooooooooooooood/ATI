<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>Results - <span th:text="${testName}"></span></title>
    <style>
        body { font-family: Arial, sans-serif; padding: 40px; background-color: #f4f7f6; text-align: center; }
        .result-box { max-width: 600px; margin: 50px auto; background-color: #ffffff; padding: 40px; border-radius: 10px; box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1); text-align: center; }
        h1 { color: #007bff; margin-bottom: 20px; }
        .score-display { font-size: 3.5em; color: #28a745; font-weight: bold; margin: 20px 0; }
        .action-link { display: inline-block; margin-top: 30px; padding: 10px 20px; background-color: #007bff; color: white; text-decoration: none; border-radius: 5px; }

        /* --- Styles for Detailed Breakdown --- */
        .details-container { max-width: 800px; margin: 40px auto; padding: 20px; background-color: #ffffff; border-radius: 10px; box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1); text-align: left; }
        .detail-row { padding: 15px 0; border-bottom: 1px solid #eee; }
        .detail-row:last-child { border-bottom: none; }
        .question-title { font-weight: bold; color: #333; margin-bottom: 5px; }
        .user-answer { font-weight: bold; padding: 2px 5px; border-radius: 3px; }
        .correct { color: #155724; background-color: #d4edda; }
        .incorrect { color: #721c24; background-color: #f8d7da; }
        .correct-display { color: #28a745; font-weight: bold; }

        /* --- Styles for Comprehensive Review Cards --- */
        .review-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(350px, 1fr)); gap: 20px; margin-top: 20px; }
        .review-card { background-color: #f8f9fa; padding: 20px; border-radius: 8px; border: 1px solid #dee2e6; text-align: left; box-shadow: 0 2px 5px rgba(0,0,0,0.05); }
        .review-card h3 { color: #007bff; margin-top: 0; font-size: 1.1em; border-bottom: 2px solid #007bff; padding-bottom: 5px; }
        .loading-review-message { padding: 20px; font-size: 1.1em; color: #6c757d; }
    </style>
</head>
<body>

<div class="result-box">
    <h1>IELTS Reading Test Results</h1>
    <h2 th:text="${testName}">Test Title Placeholder</h2>

    <p class="info-text">Your Score:</p>

    <div class="score-display">
        <span class="correct-answers" th:text="${score}">0</span> / <span class="total-questions" th:text="${totalQuestions}">40</span>
    </div>

    <p class="info-text">
        You correctly answered **<span th:text="${score}">0</span>** questions out of **<span th:text="${totalQuestions}">40</span>**.
    </p>

    <a th:href="@{/reading/tests}" class="action-link">Back to Tests List</a>
</div>

<hr style="border-top: 1px dashed #ccc; margin: 30px auto; width: 600px;"/>


<div class="details-container">
    <h2>ðŸ§  Comprehensive AI Performance Review</h2>

    <input type="hidden" id="testId" th:value="${testId}">

    <div id="loading-review-message" class="loading-review-message">
        Generating comprehensive, categorized performance review... Please wait.
    </div>

    <div id="comprehensive-review-container" class="review-grid" style="display: none;">

        <div class="review-card">
            <h3>Overview Summary</h3>
            <p id="review-summary">Loading...</p>
        </div>

        <div class="review-card">
            <h3>Vocabulary Weaknesses</h3>
            <p id="review-vocabulary">Loading...</p>
        </div>

        <div class="review-card">
            <h3>Question Type Insights</h3>
            <p id="review-question-type">Loading...</p>
        </div>

        <div class="review-card">
            <h3>Strategy Recommendations</h3>
            <p id="review-strategy">Loading...</p>
        </div>
    </div>
</div>

<hr style="border-top: 1px dashed #ccc; margin: 30px auto; width: 600px;"/>


<div class="details-container">
    <h2>Answer Review</h2>

    <div th:each="result : ${submissionResults}" class="detail-row">

        <th:block th:with="questionTypeId = ${result.questionTypeId}, isSummaryCompletion = ${questionTypeId == 8}">

            <th:block th:if="${isSummaryCompletion}">
                <div class="question-title">
                    <span th:text="${result.questionOrder} + '. ' + ${result.questionText}">Question text placeholder</span>
                </div>
                <p>
                    Your Answer (Raw):
                    <span th:text="${result.userResponse}"></span>
                    (Correct: <span th:text="${result.correctAnswer}"></span>)
                </p>
            </th:block>

            <th:block th:if="${!isSummaryCompletion}">
                <p class="question-title">
                    <span th:text="${result.questionOrder} + '. '">1. </span>
                    <span th:text="${result.questionText}">Question text placeholder</span>
                </p>
            </th:block>

            <p>
                Your Answer:
                <span class="user-answer"
                      th:text="${#strings.isEmpty(result.userResponse)} ? '--- SKIPPED ---' : ${result.userResponse}"
                      th:classappend="${result.isCorrect()} ? 'correct' : 'incorrect'">
                    User's Answer
                </span>

                <span th:if="${!result.isCorrect()}" class="correct-display">
                    (Correct: [[${result.correctAnswer}]])
                </span>
            </p>

        </th:block>
    </div>
</div>

<script type="text/javascript" th:src="@{/js/results-review-fetch.js}"></script>
</body>
</html>