<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title th:text="${test.testName} + ' - Test Detail'"></title>
</head>
<body>

<div class="test-header">
    <h1 th:text="${test.testName}">Test Name Placeholder</h1>
    <p>
        IELTS Level: <span th:text="${test.testLevel}"></span> |
        Total Passages: <span th:text="${#lists.size(test.passages)}"></span>
    </p>
</div>

<form id="submissionForm" th:action="@{/reading/tests/submit}" method="POST">
    <input type="hidden" name="testId" th:value="${test.id}" />

    <div th:each="data : ${indexedQuestions}" class="question-data">

        <div class="question-group-header">

            <h2 th:if="${data.get('question').questionOrder == 1}"
                th:text="'Passage ' + ${data.get('passage').passageOrder} + ' - ' + ${data.get('passage').title}"></h2>

            <h3 th:if="${data.get('question').questionOrder == data.get('group').questions[0].questionOrder}" class="group-heading">
                Questions [[${data.get('group').questions[0].questionOrder}]] - [[${data.get('group').questions[#lists.size(data.get('group').questions)-1].questionOrder}]]
            </h3>

            <p th:if="${data.get('question').questionOrder == data.get('group').questions[0].questionOrder}"
               class="group-instructions"
               th:text="${data.get('group').instructions}">
            </p>
        </div>

        <div class="question">
            <p>
                <span th:text="${data.get('question').questionOrder} + '.'"></span>
                <span th:text="${data.get('question').questionText}"></span>
            </p>

            <input type="hidden"
                   th:name="'answers[' + ${data.get('index')} + '].questionId'"
                   th:value="${data.get('question').id}" />

            <div th:if="${data.get('question').parsedOptions != null and !#maps.isEmpty(data.get('question').parsedOptions)}">
                <div th:each="optionEntry : ${data.get('question').parsedOptions}">
                    <label>
                        <input type="radio"
                               th:name="'answers[' + ${data.get('index')} + '].userResponse'"
                               th:value="${optionEntry.key}" />
                        <span th:text="${optionEntry.key} + '. ' + ${optionEntry.value}"></span>
                    </label>
                </div>
            </div>

            <div th:if="${data.get('question').parsedOptions == null or #maps.isEmpty(data.get('question').parsedOptions)}">
                <input type="text"
                       th:name="'answers[' + ${data.get('index')} + '].userResponse'"
                       placeholder="Enter answer" />
            </div>
        </div>
        <hr/>
    </div>

    <button type="submit">Submit Test Answers</button>
</form>

</body>
</html>