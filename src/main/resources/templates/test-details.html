<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title th:text="${test.testName} + ' - Test Detail'">Test Detail</title>

    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" th:href="@{/css/header.css}">
    <link rel="stylesheet" th:href="@{/css/index.css}">
    <link rel="stylesheet" th:href="@{/css/practice-page.css}">
    <link rel="stylesheet" th:href="@{/css/footer.css}">


    <style>
        :root {
            --brand-red: #dc2626;
            --brand-dark: #7f1d1d;
        }
        body {
            font-family: 'Segoe UI', Roboto, sans-serif;
            background-color: #f9fafb;
        }
        /* Custom Red Radio Buttons */
        input[type="radio"] {
            accent-color: var(--brand-red);
            width: 1.1rem;
            height: 1.1rem;
            margin-top: 0.15rem;
        }
    </style>
</head>
<body class="flex flex-col min-h-screen text-gray-800">

<header th:replace="~{fragments/header :: header}"></header>

<main class="flex-grow container mx-auto px-4 py-8 max-w-4xl">

    <div class="test-header bg-white p-6 rounded-xl shadow-sm border-t-4 border-red-600 mb-8">
        <h1 class="text-3xl font-bold text-gray-900 mb-3" th:text="${test.testName}">Test Name Placeholder</h1>

        <div class="flex items-center gap-4 text-sm text-gray-600">
                <span class="inline-flex items-center gap-2 bg-red-50 text-red-700 px-3 py-1 rounded-full font-bold border border-red-100">
                    <i class="fas fa-layer-group"></i>
                    Level: <span th:text="${test.testLevel}"></span>
                </span>

            <span class="inline-flex items-center gap-2 bg-gray-100 text-gray-700 px-3 py-1 rounded-full font-medium">
                    <i class="fas fa-book-open"></i>
                    Total Passages: <span th:text="${#lists.size(test.passages)}"></span>
                </span>
        </div>
    </div>

    <form id="submissionForm" th:action="@{/reading/tests/submit}" method="POST" class="pb-24">
        <input type="hidden" name="testId" th:value="${test.id}" />

        <div th:each="data, stat : ${indexedQuestions}" class="question-data">

            <div th:if="${stat.first} or ${data.get('passage').passageId != indexedQuestions[stat.index - 1].get('passage').passageId}">

                <h2 class="text-2xl font-bold text-gray-800 mt-10 mb-6 pb-3 border-b-2 border-red-600"
                    th:text="'Passage ' + ${data.get('passage').passageOrder} + ' - ' + ${data.get('passage').title}"></h2>

                <div th:utext="${data.get('passage').passageText}"
                     class="passage-text-content bg-white p-6 mb-8 rounded-xl shadow-lg border border-gray-100 text-gray-800 leading-relaxed text-justify">
                </div>
                <hr class="my-6 border-gray-100"/>
            </div>

            <div class="question-group-header">

                <h3 th:if="${data.get('question').questionOrder == data.get('group').questions[0].questionOrder}"
                    class="group-heading text-lg font-bold text-gray-800 mt-6 mb-3 flex items-center gap-2">
                    <i class="fas fa-list-ol text-red-500"></i>
                    Questions [[${data.get('group').questions[0].questionOrder}]] - [[${data.get('group').questions[#lists.size(data.get('group').questions)-1].questionOrder}]]
                </h3>

                <p th:if="${data.get('question').questionOrder == data.get('group').questions[0].questionOrder}"
                   class="group-instructions bg-gray-100 border-l-4 border-red-500 p-4 rounded-r-md text-gray-700 italic mb-6 text-sm leading-relaxed shadow-sm"
                   th:text="${data.get('group').instructions}">
                </p>
            </div>

            <div class="question bg-white p-6 rounded-lg shadow-sm border border-gray-200 hover:border-red-200 transition-colors mb-6">

                <p class="text-lg font-medium text-gray-900 mb-4 flex items-start gap-2">
                    <span class="text-red-600 font-bold min-w-[1.5rem]" th:text="${data.get('question').questionOrder} + '.'"></span>
                    <span th:text="${data.get('question').questionText}"></span>
                </p>

                <input type="hidden"
                       th:name="'answers[' + ${data.get('index')} + '].questionId'"
                       th:value="${data.get('question').id}" />

                <div th:if="${data.get('question').parsedOptions != null and !#maps.isEmpty(data.get('question').parsedOptions)}"
                     class="space-y-3 ml-8">
                    <div th:each="optionEntry : ${data.get('question').parsedOptions}">
                        <label class="flex items-start gap-3 cursor-pointer group p-2 rounded hover:bg-red-50 transition-colors">
                            <input type="radio"
                                   th:name="'answers[' + ${data.get('index')} + '].userResponse'"
                                   th:value="${optionEntry.key}"
                                   class="cursor-pointer" />
                            <span class="text-gray-700 group-hover:text-gray-900 font-medium"
                                  th:text="${optionEntry.key} + '. ' + ${optionEntry.value}"></span>
                        </label>
                    </div>
                </div>

                <div th:if="${data.get('question').parsedOptions == null or #maps.isEmpty(data.get('question').parsedOptions)}"
                     class="ml-8">
                    <input type="text"
                           class="w-full md:w-2/3 px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-red-500 focus:border-transparent transition-shadow bg-gray-50 focus:bg-white"
                           th:name="'answers[' + ${data.get('index')} + '].userResponse'"
                           placeholder="Type your answer here..." />
                </div>
            </div>
            <hr class="my-6 border-gray-100"/>
        </div>

        <div class="fixed bottom-0 left-0 right-0 bg-white border-t border-gray-200 p-4 shadow-[0_-4px_6px_-1px_rgba(0,0,0,0.1)] z-50">
            <div class="container mx-auto max-w-4xl flex justify-end items-center">
                <button type="submit"
                        class="bg-red-600 hover:bg-red-700 text-white font-bold py-3 px-8 rounded-lg shadow-lg transition-transform transform hover:-translate-y-0.5 flex items-center gap-2">
                    <span>Submit Test Answers</span>
                    <i class="fas fa-paper-plane"></i>
                </button>
            </div>
        </div>
    </form>

</main>

<div class="h-24"></div>
<footer th:replace="~{fragments/footer :: footer}"></footer>

</body>
</html>